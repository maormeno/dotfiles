#!/usr/bin/env node

/**
 * Get themes from the Squirrelsong repo
 *
 * This scripts syncs color themes for:
 * [x] Bat
 * [x] WezTerm
 *
 * To sync Bear theme, run `sync-colors-bear`
 *
 * Author: Artem Sapegin, sapegin.me
 * License: MIT
 * https://github.com/sapegin/dotfiles
 */

import path from 'path';
import fs from 'fs-extra';
import { execSync } from 'child_process';
import ky from 'ky';

const HOME = path.dirname(path.dirname(import.meta.dirname));

const REPO_ROOT =
	'https://raw.githubusercontent.com/sapegin/squirrelsong/master';
const DEST_DIR = `${HOME}/dotfiles/tilde`;

function download(filepath) {
	return ky.get(`${REPO_ROOT}/${encodeURI(filepath)}`).text();
}

function write(file, text) {
	const fullPath = path.join(DEST_DIR, file);
	fs.ensureDir(path.dirname(fullPath));
	return fs.writeFileSync(fullPath, text);
}

async function install(from, toDir) {
	const theme = await download(from);
	const filename = path.basename(from);
	write(path.join(toDir, filename), theme);
}

/**
 * Bat: https://github.com/sharkdp/bat?tab=readme-ov-file#adding-new-themes
 */

console.log('ðŸŒˆ Installing Bat theme...');

await install(
	'/dark/Sublime Text/Squirrelsong Dark/Squirrelsong Dark.tmTheme',
	'.config/bat/themes'
);
execSync(`bat cache --build`);

/**
 * WezTerm
 */

console.log('ðŸŒˆ Installing WezTerm theme...');

await install('dark/WezTerm/squirrelsong-dark.toml', '.config/wezterm/colors');

console.log();
console.log('ðŸ¦œ Now run `dotfiles` to sync all the config files');
