{{- if eq .chezmoi.os "darwin" -}}
#!/bin/bash
set -euo pipefail

# Trigger rerun when the nice CLI Brewfile content changes.
# brewfile-sha256: {{ include "dot_Brewfile.nice-cli" | sha256sum }}

if ! command -v brew >/dev/null 2>&1; then
  echo "Homebrew is required to install nice CLI packages."
  exit 1
fi

# Install/update nice CLI packages directly from managed source content.
brew bundle --file=/dev/stdin <<'EOF'
{{ include "dot_Brewfile.nice-cli" }}
EOF

# Keep completion parent dirs secure for zsh compinit checks.
BREW_PREFIX="$(brew --prefix 2>/dev/null || true)"
if [[ -n "${BREW_PREFIX}" && -d "${BREW_PREFIX}/share" ]]; then
  chmod go-w "${BREW_PREFIX}/share" 2>/dev/null || true
fi
unset BREW_PREFIX
{{- end -}}
