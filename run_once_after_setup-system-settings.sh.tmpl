{{- if eq .chezmoi.os "darwin" -}}
#!/bin/bash
set -euo pipefail

# Configure visual-focused macOS defaults once.
echo "Applying one-time macOS visual settings..."

# Close System Settings so defaults writes are not overwritten live.
osascript -e 'tell application "System Settings" to quit' || true

# Always show ~/Library in Finder.
chflags nohidden "$HOME/Library"

# Prefer non-natural scrolling for precision on trackpad.
defaults write -g com.apple.swipescrolldirection -bool false

# Enable right-click corner behavior on trackpad.
defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad TrackpadCornerSecondaryClick -int 2
defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad TrackpadRightClick -bool true
defaults write com.apple.AppleMultitouchTrackpad TrackpadCornerSecondaryClick -int 2
defaults write com.apple.AppleMultitouchTrackpad TrackpadRightClick -bool true

# Make dock auto-hide for more screen space.
defaults write com.apple.dock autohide -bool true

# Set Finder to icon view by default.
defaults write com.apple.finder FXPreferredViewStyle -string "icnv"

# Restart affected services to apply settings quickly.
killall Dock >/dev/null 2>&1 || true
killall Finder >/dev/null 2>&1 || true

echo "macOS visual settings applied."
{{- end -}}
