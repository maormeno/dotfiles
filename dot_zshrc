# Primary Zsh entrypoint managed by chezmoi.

# Load shared dotfiles fragments that do not depend on completion init.
for file in ~/.dotfiles/.{aliases,exports,functions}; do
  [[ -r "$file" && -f "$file" ]] && source "$file"
done
unset file

# Keep shell history persistent and deduplicated.
HISTFILE=~/.zsh_history
HISTSIZE=10000
SAVEHIST=10000
setopt appendhistory
setopt share_history
setopt hist_ignore_all_dups
setopt hist_save_no_dups

# Resolve Homebrew prefix for completion paths.
BREW_PREFIX=""
if command -v brew >/dev/null 2>&1; then
  BREW_PREFIX="$(brew --prefix)"
fi

# Load Homebrew completion definitions before compinit.
if [[ -n "$BREW_PREFIX" && -d "$BREW_PREFIX/share/zsh-completions" ]]; then
  fpath=("$BREW_PREFIX/share/zsh-completions" $fpath)
fi

# Initialize completion system.
autoload -Uz compinit
compinit

# Load extras late so plugin/prompt hooks initialize in final shell state.
if [[ -r ~/.dotfiles/.extra && -f ~/.dotfiles/.extra ]]; then
  source ~/.dotfiles/.extra
fi

# Fallback prompt when Starship is not installed.
if ! command -v starship >/dev/null 2>&1; then
  autoload -Uz promptinit
  promptinit
  prompt adam1
fi

# Cleanup temporary variable.
unset BREW_PREFIX
